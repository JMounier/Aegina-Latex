\documentclass[12pt,a4paper]{article}
\RequirePackage[french]{babel}
\usepackage{fancyhdr}
\usepackage[latin1]{inputenc}
\usepackage{amsfonts}
\usepackage[french]{babel}
\usepackage{listings}
\usepackage{pst-eucl}
\usepackage{setspace}
\usepackage{graphicx}
\usepackage[T1]{fontenc}
\usepackage{geometry}
\usepackage{color}
\geometry{vmargin=3.5cm,hmargin=2.25cm}
\pagestyle{plain}

\selectlanguage{french}

\begin{document}
\chead{Aegina : rapport de soutenance \no 1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{titlepage}
\begin{center} 
\huge
\vspace*{5cm}
Aegina : rapport de soutenance \no 1\\
\vspace*{2em}
\large
Florian \bsc{Amsallem} (amsall\_f) , Théo \bsc{Issarni} (issarn\_t), \\Julien \bsc{Mounier} (mounie\_a), Romain \bsc{Mounier} (mounie\_r)\\
\vspace{1em}
AIM$^{2}$\\
Aegina\\
\vspace{2cm}
\includegraphics[width=10cm]{AeIcon.png}
\end{center} 
\end{titlepage}
\onehalfspacing

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pagebreak

\section*{Introduction}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pagebreak
\addcontentsline{toc}{section}{\protect\numberline{}Introduction}

\section{Univers du jeu}

Aegina est un jeu de survie dans lequel le joueur incarne Ille un "description manquante". Le joueur serra amené à découvrir les mystères de l'univers dans lequel il évolue. C'est dans cette partie que nous vous révèlerons ces dits secrets. 
% à améliorer.

\textcolor{red}{je mettrais quand même un petit paragraphe expliquant le jeu en général}

\subsection{Aegina}

Le monde d'Aegina est constitué d'une quasi infinité d'îles volantes se trouvant au dessus d'un vide béant appelé les \textit{abysses}. Ce monde, contrairement au nôtre, est instable. Il ne partage pas nos lois de l'équilibre et de nombreux phénomènes étranges s'y déroulent sans que l'on puisse les expliquer. La présence des \textit{abysses} n'étant qu'un de ces phénomènes. 

L'instabilité de ce monde est principalement due à la présence de cristaux sur certaines îles. Ceux-ci sont capables de déchirer les trames de l'espace et du temps permettant de réaliser des miracles comme le retour dans le temps ou la téléportation. La puissance des cristaux est amplifiée lorsqu'ils sont activés. Malgré toutes ces instabilités un écosystème s'est tout de même développé. Des animaux tels que des lapins, papillons et moutons peuplent les îles d'Aegina. Mais d'autres espèces plus agressives et plus exotiques sont apparues suite à l'instabilité du monde. Parmi elles nous trouvons les \textit{slimes}. Un instinct naturel pousse toutes ces créatures agressives à s'attaquer aux cristaux lorsqu'ils sont activés pour les empêcher de rendre le monde plus instable qu'il ne l'est déjà.

 L'activation des cristaux ne  peut être réalisée que par un être doué de raison. On pourrait donc penser qu'en l'absence d'un tel être sur Aegina et avec une telle armée de créatures prêtes à défendre ce monde celui-ci aurait trouvé une certaine forme d'équilibre. Mais c'était sans compter la présence d'envahisseurs, d'êtres extérieurs à ce monde qui utilisent celui-ci à des fins barbares, les êtres humains. Bien que ne vivant pas dans ce monde et n'ayant aucune information sur celui-ci, les êtres humains on trouvé un moyen de \og téléporter \fg{} leurs déchets dans un néant qui n'est autre qu'Aegina. Lorsque les déchets arrivent directement dans les  \textit{abysses}, ils n'ont aucune influence sur la stabilité d'Aegina.  S'ils tombent sur une île, ile peuvent représenter un apport de ressource pour Aegina. L'aspect néfaste pour Aegina provient d'une sorte très particulière de déchets.
 
 Certaines autorités humaines utilisent la \og téléportation \fg{} pour se débarrasser d'autres humains. Malheureusement une fois dans le monde d'Aegina ceux-ci tentent désespérément de survivre. Ils finissent en général par arriver à activer les cristaux dont les pouvoirs quasi divins leur permettent d'échapper à la faim et à la mort. Certains ont alors voyagé d'île en île, créant quelques infrastructures telles que des ponts, laissant leur trace dans ce monde mais l'amenant petit à petit à sa fin sans le savoir. Heureusement pour ce monde, jusqu'à présent ils ont tous fini par périr sous l'assaut des créatures locales ou se sont suicidés en se jetant dans les \textit{abysses} ne pouvant rentrer chez eux. Il arrivera bien un jour où l'un d'eux emportera ce monde avec lui dans sa chute. 

\subsection{Ille}

Ille est le personnage principal de notre jeu. Il a l'apparence d'un bucheron roux et barbu. En vérité Ille n'est pas son vrai nom mais en arrivant dans le monde d'Aegina Ille a perdu la mémoire et ne s'en souvient donc plus. \textcolor{red}{C'est le personnage incarné par le joueur ? Si oui il faut le préciser, que se passe-t-il en mode multi-joueurs ?}

\subsection{Les minerais}
\textcolor{red}{ phrase d'intro, que sont les minerais, à quoi servent-ils ? Et les cristaux, il faudrait peut-être en parler un peu plus, en fait j'ajouterais une subsubsection cristaux avant de parler du mithril. Vous parlez de minerais et de minéraux, il faut être cohérents}
\subsubsection{Mithril}

Le mithril, dans le monde d'Aegina, est un minerai vert clair un peu plus solide que le fer. Assez rare à la surface des îles, on en trouve toujours en petite quantité en sous-sol puisqu'il est l'un des deux minéraux nécessaires à la \og survie \fg{} d'une île. Le mithril a l'étrange particularité d'interagir avec les phénomènes étranges d'Aegina parfois en les amplifiant d'autres fois en les stabilisant. Il est impossible de savoir comment celui-ci va réagir avant de l'utiliser.

A l'état naturel il catalyse les instabilités et les relâche sous forme de vagues d'énergie rendant le minerai chaud au toucher. Une fois épuré, le mithril continue de catalyser les instabilités mais peut alors relâcher son énergie sous de nombreuses autres formes que la chaleur comme le ferait un cristal mais à bien plus faible échelle. 

D'ailleurs l'énergie catalysée et stockée par le mithril semble être la même que celle se trouvant dans les cristaux car les deux matériaux peuvent échanger cette énergie entre eux. Ainsi quelques chercheurs hérétiques qui se sont trouvés sur Aegina ont supposé que les cristaux était formés d'un alliage composé en majorité de mithril. Ces chercheurs ont trouvé la mort quelques jours plus tard tués par des sangliers après avoir déchargé leur cristal à l'aide de mithril \textcolor{red}{ Je ne comprends pas ce que veut dire  \og décharger le cristal \og }. 

\subsubsection{Floatium}

Le floatium est un minerai quasi transparent que l'on peut trouver dans Aegina. Les humains qui arrivent dans Aegina le confondent souvent avec du quartz lorsqu'ils en voient dans la roche. Mais celui-ci est bien plus transparent et s'apparenterait plus à du verre ou de la glace. La vrai particularité du floatium se remarque une fois le minerai nettoyé de toute impureté. La première constatation est que celui-ci est bien plus solide que ce à quoi on peut penser, sa dureté égale celle du fer, mais surtout il est impossible de le faire tomber par terre. En effet une fois celui-ci lâché il flotte. 

Ce minerai est encore un mystère d'Aegina car personne ne sait pourquoi il flotte. Il n'est pas plus léger que l'air puisqu'il reste à une distance fixe du sol mais il ne semble pas s'agir non plus de force magnétique. De toute façon peu d'expériences ont eu lieu sur le floatium car, dans Aegina, en plus d'être un minerai très rare, les personnes capables de faire des expérimentations scientifiques le sont encore plus.

 La seule information sûre est que le floatium est, avec le mithril, l'un des deux composants permettant aux îles de voler. Cependant les cristaux et le floatium peuvent réagir entre eux , le cristal semble pouvoir enlever ses capacités au floatium tandis que le floatium est responsable de la rotation et de la lévitation du cristal, mais tout cela reste de la théorie. 
 
 Néanmoins il est possible de conjecturer que si un cristal à une trop grande influence sur une île il pourrait provoquer sa chute. Mais les seules personnes connaissant la vérité sur cette hypothèse sont sûrement mortes.

\subsubsection{Sunkium}

Le sunkium est un minerai d'une couleur mauve très sombre. C'est un minerai légendaire qui possède de nombreuses qualités car il est le minerai le plus rare, le plus lourd et le plus sombre, le plus solide, le plus cool, le plus classe, le plus \textit{dark} et le plus unique d'Aegina. Pourtant malgré sa solidité il n'est pas si difficile à extraire des roches car il semble repousser les autres minerai lors de sa formation ce qui permet de le trouver dans des alvéoles formées par la roche. Cependant une fois extrait son poids reste tout de même un problème pour le transporter.

 Mais ce qui fait de ce minerai le minerai le plus cool est qu'il peut être utilisé très simplement pour la création d'épées ou d'armures. En effet ce minerai a la même température de fusion que le fer et une fois mélangé à du mithril il chauffe et refroidi à une vitesse exceptionnelle. De plus la couleur sombre des armures formées avec le sunkium apporte un côté cool et \textit{dark} à toute personne les utilisant. Mais malheureusement cette impression ne dure que quelques secondes car rares sont ceux capables de se mouvoir avec une telle armure. Le plupart se retrouvent coincés dans celle-ci, incapables de bouger ou de l'enlever, amenant à la mort la plus stupide d'Aegina.
 
 Le sunkium, comme le mithril et le floatium, réagit avec les cristaux mais sa réaction est peut être la plus impressionnante des trois, après tout c'est le minerai le plus cool. Le sunkium change de volume et de masse sous l'influence du cristal mais pas comme tout le monde s'y attendrait car plus son volume diminue, plus il devient lourd. Il se met alors à absorber de la lumière assombrissant les alentours. Le cristal quant à lui peut absorber le sunkium mais personne ne sait réellement ce que ça lui apporte. 

Certaines théories stipulent que les pouvoirs du cristal viendraient de minuscules particules de sunkium qui déformeraient l'espace temps. Mais cette théorie s'appuyant sur d'autres théories qui n'ont pas été prouvées, sa véracité est plus que discutable. Sans la présence des cristaux, le sunkium serait  le minerai le plus mystérieux d'Aegina.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pagebreak

\section{Réalisation}

Maintenant que vous connaissez mieux l'univers d'Aegina nous pouvons vous parler de l'état actuelle du project.

\subsection{Pré-janvier}

\subsubsection{Cycle jour/nuit (Julien)}

Cette partie traitera principalement des \textit{skybox} et de l'utilisation que nous en faisons. La \textit{skybox} est la boite dans lequel se déroule le jeu. Les cotés de cette boite représente les limites visibles du monde et il est impossible de sortir de cette boite. La \textit{skybox} permet donc de représenter le ciel ou n'importe quel autre élément de dernier plan.

Pour réaliser le cycle jour nuit, nous avons dû déterminer la durée d'une journée que l'on a divisée en 30 phases. Chacune d'elle correspondant à une image de skybox. Seulement cette méthode à présenté quelques inconvénients. Entre autre, le changement de skybox était trop brusque et les différentes skybox n'étaient pas homogènes. C'est pourquoi nous avons dû trouver une autre méthode : la \textit{directional light}.

La \textit{directional light} est un gameobject propose par unity. Son intérêt majeur est que l'orientation de cette lumière influence la skybox du monde. De plus nous pouvons choisir la couleur et l'intensité de cette lumière. Pour ce faire nous utilisons une fonction qui converti la longueur d'onde des rayons lumineux en couleur RGB et nous représentons le spectre solaire à l'aide de la fonction mathématique suivante : 
$$255 * ((3.25t - 4)x^2 + (-4t + 4)x +(0,08 (t-1)))$$
Nous utilisons cette même fonction en fixant $t = 0$ pour définir l'intensité lumineuse.

\begin{figure}[h!]
\begin{center}\includegraphics[width=11cm]{DNgraph.png}
\caption{évolution du spectre lumineux en fonction du temps} 
\label{Graph1}
\end{center}
\end{figure}

La courbe bleu ($t=0$) représente le spectre quand le soleil est au zénith et la courbe rouge ($t = 1$) le spectre au moment du coucher du soleil. Les courbes vertes ($t=0,3$ et $t = 0,6$) montrent quand à elle l'évolution de la courbe (voir figure~\ref{Graph1}). A chaque instant, nous échantillonnons la courbe actuelle tous les 10 nm (de 380 à 780 nm), ce qui nous donne un tableau des couleurs (en RGB) que notre astre est censé émettre. Ce tableau contient environ 40 valeurs or une \textit{directional light} ne possède qu'une seule couleur. Il a donc fallu trouver un moyen pour réunir c'est 40 couleur en une seule. Pour ce faire, nous parcourons toutes les valeurs du tableau et  nous formons une nouvelle couleur en choisissant les plus grandes valeurs de rouge, de vert et de bleu rencontrées.

Nous avons ensuite implémenté la rotation et le déplacement de la \textit{directional light}. Ce fut assez simple car nous étudions les mouvements circulaire en cours de physique. Il nous a donc suffis de copier les équations paramétrique horaire en base cartésienne. C'est a dire :
$$ x(t) = R cos(wt)$$
$$ z(t)= R sin(wt)$$
\begin{center}
\textit{Où R est le rayon de l'orbite et w la vitesse angulaire.}
\end{center}
Ainsi, la \textit{directional light} suit une orbite circulaire autour du point de coordonnées (0,0,0). L'orientation de la \textit{directional light} est définie grâce a la fonction \textit{lookat} qui oriente un \textit{gameobject} vers un autre \textit{gameobject}, le point (0,0,0) dans notre cas. 

Un procédé similaire est utilisé pour la première scène du jeu. En effet, dans cette scène, la caméra orbite autour d'une île et nous nous servons de la fonction \textit{lookat} pour orienter la camera vers l'île. Mais, contrairement au cas de la \textit{directional light}, le déplacement utilise les propriétés de la base polaire. En effet, comme l'objet est toujours orienté vers le centre de sont orbite, il suffit de lui appliquer une vitesse constante pour qu'il décrive une trajectoire circulaire.
\subsubsection{Inventaire (Romain et Florian)}
Pour que notre personnage puisse posséder un grand nombre d'objets de toutes sortes sans avoir à les porter sur lui et donc se déplacer assez facilement nous avons créé un inventaire  (figure~\ref{Inventaire}). Celui-ci est constitué de 24 cases sous forme de 4 lignes et 6 colonnes. Chaque case peut contenir un élément, qui peut être déplacé grâce à un \textit{drag and drop}. De plus le joueur peut avoir une description de chacun des éléments en passant sa souris sur celui-ci. Cet inventaire s'ouvre lorsque l'on appui sur la touche \textit{inventaire} (touche \textit{i} par défaut) et peut ensuite être fermé avec la même touche \textit{inventaire} ou la touche \textit{escape}. 

\begin{figure}[h!]
\begin{center}\includegraphics[width=11cm]{Inventaire}
\caption{Format de l'inventaire} 
\label{Inventaire}
\end{center}
\end{figure}

Lorsque l'inventaire est ouvert le joueur et la camera ne peuvent plus bouger via les touches de déplacement ou la souris (mais le joueur continuera de tomber si celui-ci était entrain de chuter). L'inventaire se sauvegarde automatiquement en local lorsque le jeu est quitté normalement ou lorsque qu'une modification de son contenu s'effectue (quand un objet est jeté ou récupéré). Ce même inventaire est alors récupéré d'une partie sur l'autre.


\subsubsection{Animation 3D (Théo)}

Ille est un personnage que nous avons téléchargé depuis l'asset store de unity qui possédait initialement deux animations, \og marcher \fg{} et \og rester immobile \fg{}. Cependant ces deux seules animations ne nous suffisaient pas.
Nous avons alors décidé de faire les animations des nos personnages nous-même. 
Le premier problème que nous avons rencontré est que notre personnage n'était pas accessible depuis notre version de \textit{blender}, trop récente pour le modele 3D que nous avons. 
Il nous a donc fallu trouver une ancienne version de \textit{blender} compatible avec notre model 3D. Depuis nous essayons d'améliorer nos animations dans le but d'être le plus réaliste possible mais sans expérience dans ce domaine il est difficile de faire des animations convenables et celles-ci sont systématiquement remises en questions par les membres de l'équipe et donc modifiées.

\subsubsection{Déplacement du personnage et de sa camera (Théo et Julien)}

Le joueur détermine les déplacements de son personnage. Celui-ci peut avancer (avec la touche  \og w  \fg{}  ou  \og up  \fg{} ), reculer (avec la touche  \og s  \fg{}  ou  \og down  \fg{} ), s'orienter vers la droite (avec la touche  \og q  \fg{}  ou  \og right  \fg{} ) et s'orienter vers la gauche (avec la touche  \og d  \fg{}  ou  \og left  \fg{} ).
Notre personnage peut courir si ce dernier se déplace et que l'utilisateur appuie sur la touche  \og shift  \fg{}, il peut aussi sauter si l'utilisateur appuie sur la barre d'espace.

Le saut à d'ailleurs été un élément problématique à implanter car notre personnage ne devait pouvoir sauter qu'à partir du sol pour éviter qu'il ne s'envole en enchaînant des sauts dans les airs. Nous avons donc créé des restrictions permettant au personnage de ne sauter que depuis certains éléments du décors (qui regroupent presque tous les éléments).

A partir de ce moment notre personnage était devenu opérationnel mais à quoi cela servait-il si nous ne pouvions pas le voir ? 

Nous avons alors décidé de créer une camera qui suivrait notre personnage où qu'il aille.
Cette caméra n'est pas une simple caméra fixe, elle possède des caractéristiques variées grâce auxquelles une grande liberté est accordée au joueur. Celle-ci s'oriente grâce à la souris et même si on dit qu'elle suit le joueur l'orientation des mouvements du joueur ne dépendent que de l'orientation de la caméra. Par exemple faire reculer le joueur le fait en réalité se diriger vers le caméra.

La vue à la troisième personne permet au joueur de voir son personnage de coté, de devant ou encore de derrière.  Tout cela en étant proche ou éloigné de son personnage, ce qui permet aussi d'avoir une vision plus générale de l'environnement.  L'éloignement de la caméra et du personnage se contrôle avec la molette de la souris, il est donc malheureusement indispensable de posséder une souris à molette pour profiter à 100\% de la caméra (le trackpad d'une ordinateur portable peut lui aussi permettre de profiter de la liberté de la caméra).

La vue à la première personne permet au joueur de voir exactement ce que son personnage voit. La passage d'une vue à l'autre se fait automatiquement en approchant ou éloignant la caméra du personnage.

\subsubsection{Models 3D (Julien)}

Nous avons décidé de doter notre jeu d'un style graphique original. Nous avons cherché l'inspiration en parcourant l'asset store. Nous y avons trouvé le modèle de notre personnage principal et nous nous sommes accordés pour un univers cartoon.

Nous avons donc commencé la réalisation de notre première île mais ce fut un échec (figure~\ref{premierIle}). Nous n'avions pas assez bien défini la forme que nous voulions lui donner et il a donc fallu recommencer le modèle car celui-ci n'était pas vraiment cartoon et n'était pas adapté à la génération procédurale du monde. 

\begin{figure}[h!]
\begin{center}
\includegraphics[width=8cm]{Photo_1_premiere_ile.png}
\caption{Première île} 
\label{premierIle}
\end{center}
\end{figure}

Nous avons alors décidé de réaliser tous nos futures modèles grâce au logiciel Blender et d'importer le moins possible depuis l'asset store. Nous nous sommes donc recentrés sur l'aspect cartoon et en avons profité pour réaliser nos premiers éléments à savoir les arbres et un rocher (figure~\ref{premiersElements}).

\begin{figure}[h!]
\begin{center}
\includegraphics[width=8cm]{environment.png}
\caption{Premiers éléments} 
\label{premiersElements}
\end{center}
\end{figure}



La réalisation des modèles suivants s'est faite et continuera à se faire petit à petit en fonction des demandes engendrées par l'avancement du projet.


\subsection{Janvier}

\subsubsection{Barre de selection (Florian)}

Lorsque nous sommes en train de bouger il est impossible de voir ce que contient notre inventaire et il faut nécessairement l'ouvrir, et donc s'arrêter, pour interagir avec lui. Actuellement ce n'est pas un problème mais quand il sera nécessaire d'utiliser des ressources pour survivre et interagir avec l'environnement, nous voulons que ces dernières soient facilement accessibles sans devoir s'arrêter (pour pouvoir boire une potion de santé alors qu'un slime nous poursuit par exemple).

Nous avons donc ajouté une barre de sélection (figure~\ref{Toolbar}) synchronisée avec la 4$^{e}$ ligne de notre inventaire. Le joueur peut sélectionner une case de cette barre en utilisant les touches alphanumériques correspondantes et utiliser l'objet s'y trouvant. Cette barre apparaît même quand le joueur n'a pas affiché son inventaire puisque son but est justement d'utiliser des objets hors de l'inventaire.

\begin{figure}[h!]
\begin{center}\includegraphics[width=11cm]{Toolbar}
\caption{barre d'outil} 
\label{Toolbar}
\end{center}
\end{figure}

\subsubsection{Menus (Romain et Florian)}

Un élément essentiel à tout jeu est indéniablement de pouvoir le quitter et le commencer. Cela paraît évident mais il a tout de même fallu créer des interfaces permettant ces actions au début du jeu (pour commencer une partie)(figure~\ref{Menu1}) et au milieu du jeu (pour arrêter de jouer)(figure~\ref{Menu2}).

Pour cela nous avons créé des menus permettant non seulement de démarrer une partie ou de quitter le jeu mais aussi de modifier de nombreuses options. 

Actuellement le menu permet de modifier la langue et le volume sonore du jeu. Ces menus s'ouvrent avec la touche \textit{escape} quand aucune autre interface n'est ouverte et se ferment avec la même touche  ou avec le bouton \textit{continuer}. Lorsque le menu est ouvert, le joueur et la camera du joueur ne peuvent pas bouger comme lorsque l'inventaire est ouvert. Lors du lancement du jeu on arrive directement à un menu mais celui-ci ne se ferme pas avec la touche \textit{escape} par contre il est possible d'utiliser le raccourci pour accéder aux options. 

L'apparence graphique des menus à longtemps était discutée. Un rectangle simple coloré comme l'inventaire ne plaisait pas donc nous avons essayé de mettre comme fond un parchemin. Cependant le placement des écritures sur ce parchemin ne paraissait pas centré et celui-ci pouvait prendre des formes bizarres lorsque la dimension de la fenêtre était changée. Nous avons alors décidé de ne pas mettre de fond au menu, ce qui est finalement très acceptable esthétiquement. 

\begin{figure}[h!]
\begin{center}\includegraphics[width=10cm]{Menu1}
\caption{Menu d'accueil} 
\label{Menu1}
\end{center}
\end{figure}

\begin{figure}[h!]
\begin{center}\includegraphics[width=10cm]{Menu2}
\caption{Menu dans le jeu} 
\label{Menu2}
\end{center}
\end{figure}

\subsubsection{Class \textit{Item} (Romain)}
\textcolor{red}{ça arrive un peu tard, je ne comprend pas comment vous avez pu associer un aspect graphique à des objets qui n'existaient pas encore ??}

Pour pouvoir gérer les ressources que possède un joueur, nous avons dû créer une classe que nous avons tout simplement choisi d'appeler \textit{Item}. 

La classe \textit{Item} permet de créer un patron d'objet ne contenant que des constantes immuables qui sont le nom (dans chacune des langues disponible, pour le moment il s'agit du français et de l'anglais), la description (elle aussi dans chacune des langues proposées), un identifiant unique, une quantité maximale par personnage, une texture 2D et un élément correspondant à l'objet 3D. Cependant Lorsqu'un objet se trouve dans l'inventaire il peut y être en plusieurs exemplaires. Les objets présents dans l'inventaire sont donc une nouvelle classe appelée \textit{ItemStack} contenant une quantité (inférieure à la quantité max de l'objet) et un pointeur vers l'objet qu'il représente. Ainsi, les informations communes à plusieurs exemplaires d'un objet similaires ne sont pas dupliquées, seules les quantités sont propres à chaque inventaire. Il y a alors un grand gain de performance (\textcolor{red}{Vous pouvez quantifier ce grand gain ? Votre représentation permet un gain en mémoire mais sinon je ne pense pas que le gain soit véritable}). 

\subsubsection{Multi-joueurs (Florian)}

Le mode multi-joueurs est une part importante du projet car celle-ci permettra la coopération des joueurs pour progresser dans le jeu.
Nous avons dans un premier temps utilisé les fonctionnalités de  \textit{Unet} pour pouvoir créer un serveur (ou un host dans notre cas), mais aussi pouvoir rejoindre un serveur grâce a son adresse IP.

Nous avons dans un second temps synchronisé la position, la rotation et les actions des joueurs. Pour cela on a d'abord utilisé le composant d'unity \textit{NetworkTransform}, mais celui-ci ne permettait pas la synchronisation fluide des personnages. Du coup nous avons codé nous-même un script permettant la synchronisation des personnages. Son principe est d'envoyer au serveur la position et la rotation du personnage dès que le joueur les modifis, puis celui-ci envoie ces même informations à tous les autres clients. De plus pour rendre les déplacements le plus fluide possible nous utilisons le principe d'interpolation. Cela consiste à partir de l'ancienne et de la nouvelle position d'un joueur d'en déduire des positions intermédiaires.

Pour finir nous avons synchronisé les éléments, les sons et les caractéristiques du monde, que ce soient les îles, les biomes, les bruits de pas des joueurs, l'état de la journée (jour/nuit) ou bien les arbres.

\subsubsection{Son (Théo et Romain)}

Afin de ne pas avoir un jeu fade, nous avons introduit quelques sons. Ces sons nous permettent d'avoir une base que l'on pourra enrichir au fur et à mesure de l'avancée du développement de notre jeu.
Nous avons tout d'abord ajouté un son pour l'ouverture et la fermeture de l'inventaire et menu.
Par la suite nous avons ajouté des bruits de pas afin d'entendre notre personnage marcher ou courir. Par souci de réalisme nous avons synchronisé ces sons afin qu'ils soient entendus par tous les joueurs.


\subsection{Février}

\subsubsection{Génération procédurale du monde (Florian et Julien)}

Comme nous l'avions spécifié dans notre cahier des charges, le monde du jeu est généré de manière procédurale. Pour cette première soutenance, nous avons implémenté la génération procédurale d'un \textit{chunk}, et la liaison des chunks entre eux. Nous avons donc au lancement d'une partie un monde composé de quatre chunks chacun relié par des ponts.

Nous avons créé deux chunks différents possédant chacun une île différente, cependant rien nous empechera à l'avenir de créer des chunks ayant plusieur iles. Sur ces îles sont posées des ancres qui correspondent a des emplacements d'objets. Cela permet lors de la génération du monde de choisir un biome aléatoirement parmi forêt, désert ou neige, puis de créer sur les ancres un objet cohérent avec le biome. Par exemple dans un biome désert nous trouverons des cactus et des rochers alors que dans un biome forêt nous trouverons des arbres et des fleurs.

Nous avons donc tous les éléments pour créer des chunks, il ne restera plus qu'a faire apparaître le monde de manière procédurale avec un agencement des chunks correct. Puis il sera aussi nécessaire de sauvegarder le monde avec les modifications que les joueurs y ont apportées. 

\subsubsection{Drop d'Item (Florain et Julien)}

Le drop d'un item correspond a son passage de l'inventaire au monde 3D. Pour cela le joueur a la possibilité depuis son inventaire de  glisser un tas d'objets hors de l'inventaire. Il peut aussi grâce a une touche (la touche \og Q\fg par défault), lancer l'objet sélectionné dans sa barre d'outil. Ces actions vont faire apparaître l'objet dans le monde et le lancer a quelques mètres du personnage. Dans cet état n'importe quel joueur peut alors ramasser l'objet dès qu'il est assez proche de lui. De plus si deux objets identiques sont assez proches alors ils vont se rassembler. Cela permet d'afficher moins d'objets et donc d'améliorer les performances du jeu. D'autre part les objets \og hors inventaire \fg{} depuis plus d'une minute disparaissent, cela permet encore une fois d'améliorer les performances et de ne pas avoir une île envahie de ressources non utilisées.

\subsubsection{Bibliothèque (Florian, Romain et Théo)}

\subsubsection{Histoire (Romain et Théo)}

En plus du fait que le contexte de notre monde soit fourni, le jeu lui même va tourner autour d'une histoire. Cependant actuellement l'histoire n'est pas encore définie et elle n'a donc pas encore pu être implémentée dans le jeu. Il existe néanmoins un script (au sens théâtrale du terme) racontant le début du jeu et sa fin. Ce script contient entre autre un didacticiel devant permettre au joueur de comprendre les bases du jeu. 
 
 Il est important de noter que les éléments se trouvant dans la partie Univers du jeu de ce rapport ne seront pas tous directement accessibles aux joueurs lors de l'aventure. Certaines parties devront être découvertes durant l'aventure, notamment tout ce qui concerne le fonctionnement du monde d'Aegina et l'influence négative des cristaux. 

\subsection{Mars}

\subsubsection{Intéraction avec l'environnement (Florian et Julien)}

\subsubsection{Cristal (Romain et Julien)}

Une particularité du monde d'Aegina et la présence sur certaines de ses îles d'un cristal. Ce cristal n'est pas juste comme les autres éléments du décors tel que les arbres ou les pierres, alors que ceci ont pour but d'être récolter par les joueurs les cristaux eux sont indestructible. Dans la nature les cristaux ont une couleur grise indiquant qu'il n'ont pas été activer par un joueur, ils sont alors inactifs et n'ont aucun effet sur l'environnement qui l'entoure. Lorsqu'un joueur tente d'intéragir avec un cristal inactif une fenêtre (figure~\ref{CristalHUD}) apparait proposant au joueur d'activer le cristal en échange d'un cout en ressource. 

\begin{figure}[h!]
\begin{center}\includegraphics[width=11cm]{CristalHUD.png}
\caption{Interface du cristal} 
\label{CristalHUD}
\end{center}
\end{figure}

Une fois activer le cristal change de couleur pour prendre celle de l'équipe du joueur (bleu lorsque tout les joueurs sont dans la même équipe). A l'activation, un cristal se spécialise dans l'une des trois catégories suivantes manière aléatoire : 
\begin{itemize}
\item \textbf{Attaque (60\%):} catégorie des cristaux d'attaque (ou de défense ce qui revient au même).
\item \textbf{Récolte (30\%):} catégorie des cristaux de production 
\item \textbf{Portail (10\%):} catégorie des cristaux de portail.
\end{itemize}
Actuellement, il est impossible de connaître la spécialisation d'un cristal dans le jeux, mais cela n'a que peux d'importance car pour l'instant les cristaux activer ne sont différents des cristaux inactif que par leur couleur.

\subsubsection{Chat (Florian)}

Comme déjà précisé la coopération est un élément important du jeu, pour cela la communication est primordiale. Nous avons donc ajouté un chat qui permet aux joueurs de s'envoyer des messages sans passer par un logiciel tiers. Le chat ne permet pas seulement de communiquer, il permet aussi de rentrer certaines commandes (communément appelé \textit{cheatcode}), en voici l'énumération :

\begin{description}
\item[/help :] énumère les commandes avec leurs arguments ;
\item[/time <value (int)> :] détermine l'heure de la journée ;
\item[/give <id (int)> <quantity (int)> :] ajoute à l'inventaire du joueur la quantité indiquée de l'objet dont l'identifiant correspond au paramètre ; 
\item[/nick <name (string)> :] change le nom du personnage; 
\item[/msg <player (string)> <message (string)> :] envoie un message privé au joueur dont le nom du personnage est passé en  paramètre ; 
\end{description}

Certaines de ces commandes sont surchargées, c'est a dire que nous pouvons mettre plusieurs types d'informations en argument, par exemple la commande \textit{/time day} est accepte et va mettre le soleil au zénith. D'autres commandes ont des alias par exemple la commande \textit{/msg} peut aussi être écrit \textit{/m}.

\subsubsection{Musique (Théo)}

Afin de compléter l'univers que nous essayons de créer à travers notre jeu, nous avons ajouté des musiques de fond. 
Nous avons d'abord ajouté une musique qui est associée au menu principal uniquement.
Trois autres musiques ont par la suite étaient ajoutées, chacune d'elles est associée à un thème différent, la forêt, le désert ou la neige, qui correspond chacun à un des biomes possibles pour les îles. Pour le moment le choix de la musique écouté se fait aléatoirement, il devra ensuite se faire en fonction de l'île sur laquelle se trouve le personnage. 
En multi-joueurs chaque personne peut se retrouver avec des musiques différentes au même moment.


\subsubsection{Survie (Théo)}


La survie étant le thème de notre jeu il nous fallait, construire de bonnes bases pour le développement de ce dernier. Aujourd'hui les éléments clés de notre survie son présent. Parmi ces éléments, trois sont visible du joueur directement en jeu grace à des barres (figure~\ref{LHT}). Deux de ces barres, une symbolisant la soif et l'autre la faim de votre personne, se situent en haut à droite de l'écran tandis que la troisième barre symbolisant la santé se trouve au dessus de la barre de selection.

%pose à régler
\begin{figure}[h!]
\begin{center}\includegraphics[width=11cm]{BarreLHT}
\caption{Disposition des différentes barres} 
\label{LHT}
\end{center}
\end{figure}

 Lorsque le barre de faim ou de soif sera vide vos point de vies commenceront à descendre. Cependant ces deux barres ne sont pas les seuls à pouvoir s'attaquer à vos points de vie, si vous décidé de sauter dans le vide vous perdrez des points de vie car malgré sa force et ses capacités Ille ne sait pas voler. Quand vous vous retrouvez sans points de vie vous sentirez vos force disparaître car oui c'est ce que l'on appelle la mort, cependant dans notre grande bonté nous avons décidé que la mort ne serait pas tout de suite définitif et donc chaque mort sera accompagné d'un nouveau début. La seul façon de réellement mourir dans le jeu est donc de le quitter.


\subsubsection{Alpha (Florian)}

La dernière étape avant la soutenance était de partager notre première version, \textit{v1.0-alpha}. Ce partage nous a permis d'avoir des retours de bugs et quelques avis. Les bugs importants rapportés étaient :
\begin{itemize}
\item Le respawn du joueur qui parfois ne fonctionnait pas ;
\item Un bug graphique au niveau de l'élément proche lorsque la camera était a l'intérieur ;
\item La musique qui en multi-joueurs pouvait se superposer avec la musique des autres joueurs alentour. 
\end{itemize}
Par la suite nous avons corrigé la totalité des bugs rapportés pour former la version \textit{v1.1-alpha} qui est la version présentée lors de la première soutenance.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pagebreak

\section{Prévision}

Dans cette partie, nous allons vous présenter  les différents concepts que nous implémenterons pour la soutenance \no 2 prévue entre le 2 et le 6 mai 2016.

\subsection{Les quatre grands axes}

\subsubsection{Création d'objet}

\subsubsection{Ajout des créatures}

L'ajout des créatures sera une part importante de la prochaine version. Elles devront pouvoir se déplacer de manière intelligente et attaquer les joueurs. Certaines des créatures seront passives et par conséquent n'attaqueront pas les joueurs. Les joueurs pourront alors se battre contre ces créatures et récupérer des objets pour progresser dans leur aventure.

\subsubsection{Ajout des succès}

Les succès permettrons aux joueurs de suivre l'avancement de l'histoire ainsi que de se remémorer tous les faits héroïques qu'ils ont réalisé. Un joueur pourra consulter ses succès en appuyant sur une touche (à définir) ce qui ouvrira une fenêtre. Dans cette fenêtre, les succès serrons hiérarchisés sous la forme d'un arbre. C'est à dire qu'il faudra absolument que le joueur ai réussi un dit succès pour espérer rempoter les succès suivants. Cette structure nous permettra de définir certains événement de l'histoire comme étant des succès et ainsi la bloquer tant que le joueur n'aura pas effectuer une opération clé de l'histoire. Le déclenchement des dialogues de l'histoire seront donc déclenché par la réussite des succès.

\subsubsection{PVP et Conquête}

\subsection{Les améliorations}

\subsubsection{Survie}
% la récolte entre autre.

\subsubsection{Génération procédurale et sauvegarde}

Les améliorations de la génération procédurale consisteront à un ajout de chunks et d'éléments, mais aussi la création d'un système de \textit{seed} qui permetra entre autre une sauvegarde du monde simple et performante. Un \textit{seed} est un simple nombre qui est lié au monde, cela implique que deux mondes ayant le même \textit{seed} seront identiques.   

\subsubsection{Histoire}

\subsubsection{Environnement sonore}

\subsubsection{Personnage}

\pagebreak

\section*{Conclusion}
\addcontentsline{toc}{section}{\protect\numberline{}Conclusion}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pagebreak

\section*{Annexe}
\addcontentsline{toc}{section}{\protect\numberline{}Annexe}

\subsection*{Script de l'histoire}
\addcontentsline{toc}{subsection}{\protect\numberline{}Script de l'histoire}

\subsubsection*{Légende}
\begin{itemize}
\item structure
\item \textbf{monologue du narrateur}
\item \textit{\underline{indications scéniques}}
\end{itemize}

\subsubsection*{Histoire}

L'histoire sera racontée par un narrateur.
Nom actuel du personnage : Ille (i majuscule deux l minuscule et un e minuscule)
\\
La narration sera découpée en deux parties :
\\
\begin{itemize}
\item Les cinématiques, les points importants de l'histoire, qui permettront au jeuxd'avancer (cinématique sous forme de dessin qui se suivent ou de jeux de caméra dans le monde 3D)
\item Les \og monologues\fg{} du narrateur qui auront lieu pendant que le personnage bouge et n'interrompront pas les actions du personnage. Ces monologues auront comme but de préciser le but du jeu ou de faire des remarque anodines sur l'environnement. 
\end{itemize}
 Début : 
\\
but concret : premier pas (tutoriel)
\\
\textit{\underline{Personnage bloqué}}
\\
\textbf{En ouvrant les yeux Ille sentit l'air et les doux rayons du soleil caresser son visage. Ille avait l'impression d'avoir dormi très longtemps à tel point que Ille doutait de savoir encore se mouvoir. Ille décida alors de se lever et de faire un peu d'exercice pour faire passer cette impression.}
\\
\textit{\underline{Personnage débloqué}}
\\
Sous but :
\\
\textbf{Ille commence par se déplacer un petit peu pour se réhabituer à ses jambes (touche droite gauche haut et bas)}
\begin{itemize}
\item se déplacer
\end{itemize}
\textbf{S'étant habitué à ses jambes, iI décide de se mettre à courir ( touche shift enfoncée)}
\begin{itemize}
\item courir
\end{itemize}
\textbf{Ille est tellement en forme qu'il pense même pouvoir se permettre de sauter sans problème (touche espace)}
\begin{itemize}
\item sauter
\end{itemize}
\textbf{Juste après avoir sauté, il entend un sinistre grognement.} 
\\
\textit{\underline{petite pause dramatique}}
\\
\textbf {Ille a faim. Cependant dans cette contrée sauvage, Il devine qu'il doit chasser sa nourriture. Mais pour chasser Il a besoin d'une arme. Justement Il remarque un bâton sur le chemin, L'arme parfaite pour lui (ramasser les objets en avançant dessus)}
\begin{itemize}
\item récupérer un item au sol (un bâton par exemple)
\end{itemize}
\textbf{Après avoir mis le bâton dans sa poche, il se dit qu'il devrait peut être le sortir de celle-ci pour que son arme soit utilisable  (ouvrez l'inventaire avec I et faites glisser le bâton dans la 4$^{eme}$ ligne correspondant aux équipements rapides)}
\begin{itemize}
\item ouvrir l'inventaire
\item mettre le bâton dans la barre de raccourcis
\end{itemize}
\textbf{Il se met à la recherche de nourriture et il en se retournant tombe nez à nez avec un lapin. Ni une ni deux, il attaque son petit déjeuner ( attaquer en ...)}
\begin{itemize}
\item utiliser le bâton pour tuer un lapin
\end{itemize}
\textbf{Cependant, il avait un vague souvenir que la viande crue n'était pas très digeste au petit déjeuner. Faute de feu Il décida quand même de manger sa viande préparée en brochette. ouvrez l'inventaire puis créez une brochette)}
\begin{itemize}
\item créer de la nourriture à partir du bâton et du lapin tué (brochette)
\end{itemize}
\textbf{Finalement le repas de Ille est près. Il ne lui suffit plus que de consommer sa brochette et le grondement de son ventre cessera (utiliser un consommable avec clic droit)}
\begin{itemize}
\item utiliser un consommable (ici la nourriture)
\end{itemize}

\bigskip
but concret : activer le premier cristal 

\textit{\underline{Personnage bloqué}}
\\
\textbf{Maintenant que Ille a trouvé de quoi survivre, il peutt enfin se reposer. Jusqu'à présent  Ille n'a pensé qu'à manger mais une fois le ventre rempli il se mit à penser et à se questionner \og Mais où suis-je? Quel est cet endroit ?\fg{} En effet cet archipel d'îles volantes ne lui est pas familier \og Attend !!! Des îles volantes ?? Mais ce n'est pas possible, ça ne peut pas exister\fg{} Et pourtant ce qui s'étend à perte de vue n'est pas une illusion. Ille ne se trouve plus chez lui, peut être même plus dans son monde.}  \textit{\underline{petite pause}}
\\
\textbf{Quand Ille a assimilé ce qui lui arrive, il prend une décision \og Il faut absolument que je comprenne où je suis et pour ça il faut que j'explore ces drôles d'îles\fg{} Et c'est ainsi que Ille commence son aventure.}
\\
\textit{\underline{Personnage débloqué}}
\\
sous but : 
\\
\textbf{Pour commencer son exploration ,la première chose que Ille fait est de traverser un pont séparant deux îles.}
\begin{itemize}
\item emprunter un pont
\end{itemize}
\textbf{Il ne manque pas de se demander ce qu'un pont peut bien faire dans cet archipel ayant pourtant l'air abandonné et espère que celui-ci ne va pas s'écrouler sous son poids\dots heureusement cela n'arrive pas. en traversant ce pont ,Ille voit à l'horizon une sorte de reflet et intrigué décide de chercher sa source.}
\begin{itemize}
\item trouver un cristal
\end{itemize}
\textbf{Le reflet vient d'un gigantesque cristal taillé comme un prisme mais le plus impressionnant est que celui-ci lévite \dots Malgré sa stupeur, Ille se ressaisit assez vite \og hum pas si étonnant que ça vu que je me trouve actuellement sur une île volant dans le ciel\fg{}. Après s'être calmé et posé, il voit que le cristal réagit à sa présence et plus précisément au métal de sa boucle de ceinture qui semble attirée vers le cristal. Ille décide donc d'aller chercher du métal pour tester ces étranges réactions et s'éloigne rapidement ne voulant pas perdre sa précieuse ceinture.
En s'éloignant Il se dit que pour récupérer du métal cela va être plus dur que de ramasser du bois ou de tuer des lapins. Il doit donc fabriquer quelque chose pour récupérer et raffiner le métal.}
\begin{itemize}
\item fabriquer une pioche
\item créer une forge
\end{itemize}
\textbf{Maintenant qu'il possède une minuscule forge Il peut enfin produire du métal pour le cristal.}
\begin{itemize}
\item récolter les ressources pour activer le cristal
\item activer le cristal
\end{itemize}
\textit{\underline{Cinématique !!}}

\bigskip
première/mauvaise fin :
\\
\textbf{Ille a finalement réussi. Après tout ses efforts il a recréé un portail lui permettant de revenir chez lui. C'est en hâte qu'il efface ses derniers doutes et plonge dans le portail. Il ne sait toujours pas qui il est mais cela n'a
 plus d'importance.  Il pourra facilement répondre à ces questions un fois chez lui. Cependant, il a oublié un dernier détail. S'il se trouve ici ce n'est sûrement pas par hasard. Quelque chose ou  quelqu'un a dû l'y envoyer et peut-être que rien n'empêchera cette chose de le renvoyer ici\dots ou pire.}
\\
\textit{\underline{Cri d'agonie au loin}}
\\
seconde/bonne fin : à écrire
\end{document}
